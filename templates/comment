<%inherit file="base.mako" />
<%block name="include_head" >
<script>
$("[value=reply]").ready(() => {
    $("[value=reply]").click( function() {
        $("[name=comment_id]",$($("form")[0])).val($("[name=id]",$(this).parent("p")).val())
        console.log($("[name=id]",$(this).parent("p")).val())
        $(".focus").toggleClass("focus")
        $(this).parent("p").toggleClass("focus")
    })
})
</script>
<style>
.focus { background:yellow;border-radius:.5em; }
</style>
</%block>
<%def name="print_comment(comment, depth=0)">
<div>
<p>
<input type=hidden class=hidden name=id value=${comment["id"]} ><span class=${comment["category"]} >${comment["category"]}</span><br/>
${comment["message"]}
<br/>

<a href=${comment["factoid"]}>${comment["factoid"] or ""}</a><br/>
<input type=submit value=reply />
</p>

    % if "answer" in  comment.keys():
      
      % for item in comment["answer"]:
      % if "answer" in item.keys():
                    <!-- print this item for this level -->
                        ${print_comment(item, depth+1)}
                    <!-- end this level (close div or anything that should contain next level -->
                % else:
                <div>
                <p>
<input type=hidden class=hidden name=id value=${item["id"]} ><span class=${item["category"]} >${item["category"]}</span><br/>
${item["message"]}
<br/>
<a href=${item["factoid"]}>${item["factoid"]}</a><br/>
<input type=submit value=reply />
</div>
</p>
                    <!-- handle bottom level (linke, or div, etc.) -->
                    <!-- close any elements for bottom level not already closed -->
                % endif
                
            % endfor
    % endif
                    </div>
</%def>



%for item in fo["result"][0]:
    ${ print_comment(item, 0) }

%endfor


    <form class=modal action=/comment >
    <input type=number name=id />
    <input type=number name=user_id value=${fo.get("_user_id",[-1])[0]} />
    <input type=number name=comment_id  />
    <textarea name=message rows=10 cols=50 nullable=false ></textarea>
    <input type=url name=factoid />
        <%include file="category.mako" args='category="category"'  />
        <input type=datetime-local name=created_at_time default=func.now() class=hidden />
        <input name=_action type=submit value=create >
    </form>
    <form action=/transition >
        <input type=number name=id />
        <input type=number name=previous_comment_id reference=comment.id nullable=false />
        <input type=number name=next_comment_id reference=comment.id nullable=false />

    </form>

